### 1.Kafka和RocketMq性能对比  

kafka单机写入TPS约在百万条/秒，消息大小10个字节，RocketMQ单机写入TPS单实例约7万条/秒，单机部署3个Broker，可以跑到最高12万条/秒，消息大小10个字节。    
总结：Kafka的TPS跑到单机百万，主要是由于Producer端将多个小消息合并，批量发向Broker。         
RocketMQ为什么没有这么做？     
Kafka是直接写IO的，但RocketMq不是，缓存过多消息，GC是个很严重的问题。但是RocketMQ上来先写到哪我也不清楚。

### 2. 单机支持的队列数

Kafka单机超过64个队列/分区，Load会发生明显的飙高现象，队列越多，load越高，发送消息响应时间变长。RocketMQ单机支持最高5万个队列，负载不会发生明显变化
队列多有什么好处？      
单机可以创建更多话题，因为每个主题都是由一批队列组成      
消费者的集群规模和队列数成正比，队列越多，消费类集群可以越大     

### 3.消息投递实时性   
Kafka使用短轮询方式，实时性取决于轮询间隔时间，0.8以后版本支持长轮询。
RocketMQ使用长轮询，同Push方式实时性一致，消息的投递延时通常在几个毫秒。

### 4.消费失败重试     
kafka消费失败不支持重试。      
RocketMQ消费失败支持定时重试，每次重试间隔时间顺延
总结：例如充值类应用，当前时刻调用运营商网关，充值失败，可能是对方压力过多，稍后再调用就会成功，如支付宝到银行扣款也是类似需求。

### 5.严格的消息顺序    
kafka支持消息顺序，但是一台代理宕机后，就会产生消息乱序，RocketMQ支持严格的消息顺序，在顺序消息场景下，一台Broker宕机后，发送消息会失败，但是不会乱序
MySQL的二进制日志分发需要严格的消息顺序。

### 6.消费并行度    

Kafka的消费并行度依赖Topic配置的分区数，如分区数为10，那么最多10台机器来并行消费（每台机器只能开启一个线程），或者一台机器消费（10个线程并行消费）。即消费并行度和分区数一致。
RocketMQ消费并行度分两种情况：
顺序消费方式并行度同kafka完全一致，乱序方式并行度取决于Consumer的线程数，如Topic配置10个队列，10台机器消费，每台机器100个线程，那么并行度为1000。

### 7.消息发送性能对比

写到吞吐量都不增长为止。
Kafka的吞吐量高达17.3w/s大。这主要取决于它的队列模式保证了写磁盘的过程是线性IO。此时broker磁盘IO已达瓶颈。    

RocketMQ也表现不俗，吞吐量在11.6w/s，磁盘IO %util已接近100%。RocketMQ的消息写入内存后即返回ack，由单独的线程专门做刷盘的操作，所有的消息均是顺序写文件。在服务端处理同步发送的性能上，Kafka>RocketMQ。 

### 8.topic数量的影响

Kafka和RocketMQ都是磁盘消息队列的模式，对于同一个消费组，一个分区只支持一个消费线程来消费消息。过少的分区，会导致消费速度大大落后于消息的生产速度。所以在实际生产环境中，一个Topic会设置成多分区的模式，来支持多个消费者

RocketMQ也表现不俗，吞吐量在11.6w/s，磁盘IO %util已接近100%。RocketMQ的消息写入内存后即返回ack，由单独的线程专门做刷盘的操作，所有的消息均是顺序写文件。在服务端处理同步发送的性能上，Kafka>RocketMQ。 数量


